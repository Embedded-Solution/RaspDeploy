server {
    listen 80;
    server_name     	clients3.google.com ;              # Android 4.x
                        connectivitycheck.android.com;     # Android 5.x
                        connectivitycheck.gstatic.com;      # https://success.tanaza.com/s/article/How-Automatic-Detection-of-Captive-Portal-works
                        # gstatic.com;                       # Samsung S5 Android 5.0
                        # googleapis.com;                    # Samsung S5 Android 5.0

                        # Apple iPhone, iPad with iOS 7, 8, 9 and recent versions of OS X
                        www.appleiphonecell.com;
                        *.apple.com;
                        www.itools.info;
                        www.ibook.info;
                        www.airport.us;
                        www.thinkdifferent.us;
                        *.apple.com.edgekey.net;
                        *.akamaiedge.net;
                        *.akamaitechnologies.com;

                        # Windows
                        ipv6.msftncsi.com;
                        ipv6.msftncsi.com.edgesuite.net;
                        www.msftncsi.com;
                        www.msftncsi.com.edgesuite.net;
                        teredo.ipv6.microsoft.com;
                        teredo.ipv6.microsoft.com.nsatc.net;
                        www.msftconnecttest.com;

    access_log      /var/log/nginx/captive-portal-access.log;
    error_log       /var/log/nginx/captive-portal-error.log;

    if ($http_user_agent ~ "^CaptiveNetworkSupport(.*)$"){
        return 302 http://172.20.1.1/;
    }

    location /generate_204 {
        return 302 http://172.20.1.1;
    }
}

